var Webflow=Webflow||[];Webflow.push((async function(){$(document).off("submit"),$("form").submit((function(e){e.preventDefault(),$("#submit-reservation-btn").attr("disabled","disabled"),$("form").css("display","none"),$("#loading-spinner").css("display","block");const t=new FormData(e.target),a=Object.fromEntries(t);return fetch("https://prod-239.westeurope.logic.azure.com:443/workflows/caf1fb3f29724796b935f61ac429634d/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=n_42Udw0aN81TUam-toKyK6vivYYNO2PEtL7ecy1PH4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{e.ok&&($("#loading-spinner").css("display","none"),$(".status-message.cc-success-message.w-form-done").css("display","block"),$("#reserverationIntroText").css("display","none"))})).catch((e=>{$(".status-message.cc-error-message.w-form-fail").css("display","block"),console.error(e.message)})),!1}))})),document.addEventListener("DOMContentLoaded",fetchInitialData);let reservations=[],bookedUpDays=[];async function fetchInitialData(){try{const[e,t]=await Promise.all([fetch("https://foodklubcalendar-e3e5gbhtenhaa9gv.germanywestcentral-01.azurewebsites.net/api/getCalendarConfig",{method:"GET",headers:{"Content-Type":"application/json"}}),fetch("https://prod-216.westeurope.logic.azure.com:443/workflows/d326445f7a8344eaad139eb31e36a44f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=WSwpr4vRmoA114RiFqNyEzQi9hKb28g6j4IMQo6S5J4",{method:"GET",headers:{"Content-Type":"application/json"}})]),a=await e.json();setupDatepickerAndTimepicker(a,await t.json())}catch(e){console.error("Error fetching initial data:",e.message),$(".status-message.cc-error-message.w-form-fail").css("display","block")}finally{$(".loadingInfo").css("display","none"),$("form").removeClass("hidden")}}function setupDatepickerAndTimepicker(e,t){let{generalOpeningDays:a,manuallyClosedDates:n,manuallyOpenedDates:s}=e;n=new Set(n||[]),s=new Set(s||[]),reservations=t||[],bookedUpDays=reservations.filter((e=>null===e.reservationPossibleUntil)).map((e=>e.date)),bookedUpDays.forEach((e=>{n.add(e)}));var o=jQuery.noConflict();o("#datepicker").datepicker({beforeShow:function(e,t){setTimeout((function(){t.dpDiv.css({top:$("#datepicker").offset().top+50,left:$("#datepicker").offset().left})}),0)},beforeShowDay:function(e){const t=(e=>{const t=$.datepicker.formatDate("yy-mm-dd",e),o=e.getDay();return a.includes(o)&&!n.has(t)||s.has(t)})(e);return[t]},minDate:new Date,showButtonPanel:!0,onSelect:function(e){updateAvailableHours(e)}}),o((function(e){e.datepicker.regional.de={clearText:"löschen",clearStatus:"aktuelles Datum löschen",closeText:"schließen",closeStatus:"ohne Änderungen schließen",prevText:"<zurück",prevStatus:"letzten Monat zeigen",nextText:"Vor>",nextStatus:"nächsten Monat zeigen",currentText:"heute",currentStatus:"",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],monthStatus:"anderen Monat anzeigen",yearStatus:"anderes Jahr anzeigen",weekHeader:"Wo",weekStatus:"Woche des Monats",dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],dayStatus:"Setze DD als ersten Wochentag",dateStatus:"Wähle D, M d",dateFormat:"dd.mm.yy",firstDay:1,initStatus:"Wähle ein Datum",isRTL:!1},e.datepicker.setDefaults(e.datepicker.regional.de)}));const i=reservations.find((e=>isToday(e.date)));if(void 0!==i)setAvailableHours(i.date),$(".loadingInfo").css("display","none"),$("form").removeClass("hidden");else{setAvailableHours((new Date).toISOString().split("T")[0]),$(".loadingInfo").css("display","none"),$("form").removeClass("hidden")}}function setAvailableHours(e){let t=reservations.find((t=>t.date===e))?.reservationPossibleUntil;jQuery.noConflict()("#timepicker").timepicker({timeFormat:"HH:mm",interval:30,minTime:"17:00",maxTime:t||"21:30",defaultTime:"17:00",startTime:"17:00",dynamic:!1,dropdown:!0,scrollbar:!1})}function updateAvailableHours(e){let t=reservations.find((t=>t.date===formatDate(e)))?.reservationPossibleUntil;jQuery.noConflict()("#timepicker").timepicker("option","maxTime",t||"21:30")}function formatDate(e){const t=e.split(".");return`${t[2]}-${t[1]}-${t[0]}`}function isToday(e){const t=new Date,a=t.getMonth()+1;return+e.split("-")[0]===t.getFullYear()&&+e.split("-")[1]===a&&+e.split("-")[2]===t.getDate()}